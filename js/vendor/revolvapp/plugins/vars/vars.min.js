Revolvapp,Revolvapp.add("plugin","vars",{translations:{en:{vars:{variable:"Variables"}}},defaults:{icon:'<svg height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="m8 0c4.418278 0 8 3.581722 8 8s-3.581722 8-8 8-8-3.581722-8-8 3.581722-8 8-8zm0 2c-3.3137085 0-6 2.6862915-6 6s2.6862915 6 6 6 6-2.6862915 6-6-2.6862915-6-6-6zm-.04375592 2c1.59851929 0 2.78098562.82644628 2.84667822 2.45730028h-1.72990447c-.01094876-.52892562-.4051042-.90358127-1.11677375-.90358127-.67882327 0-1.02918366.30853994-1.02918366.71625344 0 1.36639119 4.07293958.12121212 4.07293958 3.23966942 0 1.43250693-1.08392747 2.49035813-3.01090964 2.49035813-1.86128959 0-2.99996087-1.0688705-2.98901211-2.65564738h1.65326311c.03284629.6060606.51459183 1.05785128 1.39049282 1.05785128.72261831 0 1.14962004-.2754821 1.14962004-.76033062 0-1.43250689-3.99629825-.15426997-3.99629825-3.32782369 0-1.2892562.99633737-2.31404959 2.75908811-2.31404959z"/></svg>',items:{},classname:Revolvapp.prefix+"-vars",template:{start:"",end:""}},init:function(){},start:function(){this.app.toolbar.add("vars",{title:"## vars.variable ##",icon:this.opts.vars.icon,components:"editable",command:"vars.popup"})},popup:function(t,a,i){this.app.popup.create("vars",{width:"600px",builder:"vars.buildItems"}),this.app.popup.open({button:t})},insert:function(t,a,i){this.app.popup.close();let e=this.opts.vars.template.start,s=this.opts.vars.template.end;this.app.component.insert(e+i+s,"after")},buildItems:function(t){let a,i,e=this,s=this.opts.vars.items,n=this.dom("<div>").addClass("fields");for(let p in s)i=s[p].description?p:"",a=s[p].description?s[p].description:"",n.append(this._group_items(s[p],i,a));n.find("."+this.opts.vars.classname).on("click.revolvapp",function(t){t.preventDefault(),t.stopPropagation(),e.app.insertion.insertNode(this.dataset.name,"after"),e.app.popup.close();let a=e.app.component.get();a.isEditable()&&(a.sync(),e.app.editor.adjustHeight())}),t.$body.attr("style","margin: 15px"),t.$body.append(n)},_group_items:function(t,a,i){let e=this.dom("<div>").addClass("fields-group");for(let s in a&&(e.append(this.dom("<h5>").html(a)),i&&e.append(this.dom("<p>").addClass("hint").html(i))),t)"description"!==s&&e.append(this._wrap_item(s,t[s]));return e},_wrap_item:function(t,a){let i,e=t.match(/(\S{1,25})/g),s=this.dom("<div>").addClass("name").attr("style","width: 250px"),n=this.dom("<span>").attr("style",'font-family: SFMono-Regular, Consolas, "Liberation Mono", Menlo, Courier, monospace;background-color: #dae9ff;display: inline-block;border-radius: 3px;font-size: 13px;color: #111;line-height: 1;min-height: initial;padding: 4px 10px;white-space: nowrap;text-transform: none;font-weight: normal;'),p=this.dom("<div>").addClass("value").attr("style","vertical-align: middle").html('<span class="gray">'+a+"</span>");return/^%\S+_LINK%$/.test(t)&&(t='<a href="'+t+'" style="font-family: Helvetica, Arial, sans-serif;font-size: 16px;font-weight: normal;line-height: 1.5;color: rgb(0, 145, 255);text-decoration: underline;">'+a+"</a>"),i=this.dom("<div>").addClass("field rex-popup-item "+this.opts.vars.classname).attr("style","padding: 0").attr("data-name",t),n.html(e.join("<br>")),s.html(n),i.append(s),i.append(p),i}});
